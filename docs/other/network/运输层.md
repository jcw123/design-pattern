1、TCP的三个核心问题：滑动窗口、流量控制、拥塞控制。

2、运输层具有“复用”和“分用”的功能，多个应用进程复用同一个运输层，而运输层从网络层接收到
数据口，能够正确转发给不同的应用进程。

3、UDP的特点：
（1）无连接的：不需要向TCP那样先经过三次过程建立连接的过程；
（2）尽最大努力交互：不保证可靠交互，只是将数据尽可能的交互给上层；
（3）面向报文的：应用层交给UDP多长的报文，UDP就转发多长的报文，但是报文太长，IP层会进行分片；
（4）UDP没有拥塞控制：即不会影响发送速率，但是容易导致网络拥塞；
（5）支持一对一、一对多、多对多、多对一的交互通信；
（6）首部开销小：只有8个字节（源端口、目的端口、报文长度、校验和）

4、TCP协议的特点：
（1）面向连接的运输层协议；
（2）每一条TCP连接只能有两个端点；
（3）提供可靠交付的任务；
（4）提供全双工通信；
（5）面向字节流；

5、如何保证可靠性
（1）确认机制和重传机制
每发送一个分组都需要收到确认，如果在一段时间内没有收到确认就重传当前分组，所以对于每一个
分组，都有一个计时器与之关联，计时结束还没有收到ACK则重传分组。

6、滑动窗口
通过三个指针p1、p2、p3控制数据的状态。（已发送并收到确认；已发送但未收到确认、允许发送但尚未发送、不允许发送）
因为TCP是全双工通信，每一方都有一个发送窗口和接口窗口，这些窗口的大小不仅受到对方的影响，同时收到网络
拥塞的影响。

7、重传超时时间的选择
> RTT：报文段的往返时间
RTT(S):加权平均往返时间
RTO：重传超时时间
报文段的重传超时时间并不是固定不变的，而是根据每一个报文的往返时间动态调整的，所以涉及到算法的设计。
动态调整也可以认为有学习的能力。

8、选择确认ACK
对于在接收窗口的未连续收到的字节块通过指定未接收字节的接收边界，可以在发送字节块时，对于已经接收到的字节块
不再重新发送，但这依赖于tcp的具体实现。

9、流量控制
流量控制即是让发送方发送速率不要太快，使接收方来得及接收。否则不仅白白浪费了机器资源和网络带宽。

10、拥塞控制
> 流量控制和拥塞控制并不是独立的，两者只有相互协调才能让网络传出更稳定。
流量控制基本只受接收方窗口的控制，对网络中的情况不太关注，所以需要通过拥塞控制保证网络环境的正常。

11、 TCP首部常用字段
- URG（紧急指针）
表示该报文中有紧急的数据，应尽快的传送，而不是按照常规的方式进行排队；例如：从键盘中键入Ctrl+C中断标志时，如果涉及远程交互，应尽快交互给接收方；类似于提升报文的优先级；
- PSH （推送PSH）
一种推送标志位，有时希望在发送完请求后，立即接收到服务端的相应，则可以通过设置PSH标志，让请求尽快的达到应用程序，而不是在缓存中排队；
注：正常的是是等缓存区满后在向上交互；不要排队了，赶快处理吧
> URG和PSH很类似，但是PSH报文还是会进入缓存区，然后将当前缓存区中的数据封装后交付给应用层；而URG报文是直接绕过缓存区，直接交付给应用层；

- RST
正常连接的关闭使用FIN进行四次挥手完成，而对于异常的连接或者需要立刻关闭连接需要使用RST。RST不必等缓冲区的包都发出去，直接就丢弃缓存区的包发送RST包。而FIN需要先处理完缓存区的包接收端收到RST包后，也不必发送ACK包来确认。而FIN需要ACK包确认。

异常时刻发送RST包的场景：
（1）A向B发送连接，B上没有相应的端口，则B会发送一个RST包；
（2）比如建立连接时，但是设置了RECV_TIMEOUT，如果发送了一个syn报文后，下一个syn报文很晚才到，则客户端会发送一个RST报文，表示不想建立连接了；
（3）在一个已关闭的socket上发送数据，类似于情况1；
（4）字节流接收不全，发送了5000字节，但只接收了4998个字节，则服务端会发送RST报文；

RST攻击场景：
（1）A和B之间的连接，C伪造一个RST报文发送给B；
（2）A和B之间的连接，C伪造一个SYN报文；
> 需要伪造源IP、源端口、目的IP、目的端口，同时保证发送的报文在对应的滑动窗口之间；

12、参考文章：

- MTU和MSS的关系
> 合理控制MSS，可以防止TCP层的报文交互给网络层时，还进行分片；MTU有个最大值的限制，通常是1500字节；
MTU 可以控制为 > IP首部 + TCP首部 + MSS

https://zhuanlan.zhihu.com/p/100385612
